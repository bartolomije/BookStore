<!DOCTYPE html>
<html lang="sr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Knjige</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>Knjige u prodaji</h1>
    <nav>
      <a href="index.html">Početna</a>
      <a href="#" onclick="sendOrder()">Završi kupovinu</a>
    </nav>
  </header>

  <main>
    <section class="filters">
      <label for="minPrice">Min cena:</label>
      <input type="number" id="minPrice" value="0" onchange="applyFilters()">
      <label for="maxPrice">Max cena:</label>
      <input type="number" id="maxPrice" value="2000" onchange="applyFilters()">
      <label>
        <input type="checkbox" id="discountOnly" onchange="applyFilters()">
        Samo na popustu
      </label>
    </section>

    <section class="book-list" id="book-list">
      <!-- Knjige iz JSON-a -->
    </section>
  </main>

  <footer>
    <p>&copy; 2025 Nova Knjiga</p>
  </footer>

  <script>
    const cart = [];
    let allBooks = [];

    function addToCart(bookTitle) {
      cart.push(bookTitle);
      alert(bookTitle + " je dodat u korpu.");
    }

    function sendOrder() {
      if (cart.length === 0) {
        alert("Korpa je prazna.");
        return;
      }
      const subject = "Narudžbina knjiga";
      const body = "Želim da naručim sledeće knjige:%0D%0A- " + cart.join("%0D%0A- ");
      window.location.href = "mailto:kontakt@novaknjiga.rs?subject=" + subject + "&body=" + body;
    }

    function renderBooks(books) {
      const container = document.getElementById("book-list");
      container.innerHTML = "";
      books.forEach(book => {
        const div = document.createElement("div");
        div.className = "book";
        const discountInfo = book.discount > 0 ? `<p style='color:red;'>Popust: ${book.discount}%</p>` : "";
        const finalPrice = book.discount > 0 ? 
            `<p><del>${book.price} RSD</del> <strong>${book.price * (1 - book.discount / 100)} RSD</strong></p>` : 
            `<p>Cena: ${book.price} RSD</p>`;
        div.innerHTML = `
          <img src="${book.image}" alt="${book.title}">
          <h3>${book.title}</h3>
          <p><em>${book.author}</em></p>
          <p>${book.description}</p>
          ${discountInfo}
          ${finalPrice}
          <button onclick="addToCart('${book.title}')">Dodaj u korpu</button>
        `;
        container.appendChild(div);
      });
    }

    function applyFilters() {
      const min = parseFloat(document.getElementById("minPrice").value);
      const max = parseFloat(document.getElementById("maxPrice").value);
      const discountOnly = document.getElementById("discountOnly").checked;

      const filtered = allBooks.filter(book => {
        const finalPrice = book.price * (1 - book.discount / 100);
        return finalPrice >= min && finalPrice <= max && (!discountOnly || book.discount > 0);
      });

      renderBooks(filtered);
    }

    fetch("books.json")
      .then(response => response.json())
      .then(data => {
        allBooks = data;
        renderBooks(allBooks);
      });
  </script>
</body>
</html>
